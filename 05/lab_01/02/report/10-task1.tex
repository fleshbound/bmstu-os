\chapter{Функции обработчика прерывания от системного таймера в системах разделения времени}

\section{UNIX/Linux}

Обработчик прерывания от системного таймера \textbf{по тику} выполняет задачи:
\begin{itemize}
	\item инкремент счетчика тиков аппаратного таймера;
	\item декремент кванта текущего потока;
	\item обновление статистики использования процессора текущим процессом --- инкремент поля \textbf{c\_cpu} дексриптора текущего процесса до максимального значения 127;
	\item декремент счетчиков времени до отправки на выполнение отложенных вызовов, при достижении счетчиком нуля происходит установка флага для обработчика отложенных вызовов;
	\item инкремент часов и других таймеров системы.
\end{itemize}

Обработчик прерывания от системного таймера \textbf{по главному тику} выполняет задачи:
\begin{itemize}
	\item инициализация работы планировщика;
	\item пробуждение системных процессов \textbf{swapper}, \textbf{pagedaemon}, то есть регистрация отложенного вызова процедуры \textbf{wakeup}, которая перемещает дескрипторы процессов из списка <<спящих>> в очередь готовых процессов;
	\item декремент счетчика времени до отправки одного из следующих сигналов:
	\begin{enumerate}
		\item \textbf{SIGALRM} --- сигнал, посылаемый процессу по истечении времени, которое задано функцией \textbf{alarm()};
		\item \textbf{SIGPROF} --- сигнал, посылаемый процессу по истечении времени, которое задано в таймере профилирования;
		\item \textbf{SIGVTALRM} --- сигнал, посылаемый процессу по истечении времени, которое задано в <<виртуальном>> таймере.
	\end{enumerate}
\end{itemize}

Обработчик прерывания от системного таймера \textbf{по кванту} выполняет задачу: посылка сигнала \textbf{SIGXCPU} текущему процессу, если он превысил выделенный ему квант.

\section{Windows}

Обработчик прерывания от системного таймера \textbf{по тику} выполняет задачи:
\begin{itemize}
	\item инкремент счетчика тиков;
	\item декремент кванта текущего потока на величину, равную количеству тактов процессора, произошедших за тик. В случае, если количество затраченных потомком тактов процессора достигает квантовой цели, запускается обработка истечения кванта;
	\item декремент счетчиков тиков отложенных задач;
	\item в случае, если активен механизм профилирования ядра, инициализация отложенного вызова обработчика ловушки профилирования ядра путем постановки объекта в очередь \textbf{DPS}: обработчик ловушки профилирования регистрирует адрес команды, выполнявшейся на момент прерывания.
\end{itemize}

Обработчик прерывания от системного таймера \textbf{по главному тику} выполняет задачу: инициализация диспетчера настройки баланса путем освобождения объекта <<событие>>.
% освобождение объекта <<событие>>, который ожидает диспетчер настройки баланса, сканирующий очередь DPS (Deferred Procedure Call, отложенный вызов процедуры) по событию от таймера и повышающий приоритет процессов, которые находились в состоянии ожидания более 4 секунд.

Обработчик прерывания от системного таймера \textbf{по кванту} выполняет задачу: инициализация диспетчеризации потоков --- постановка соответствующего объекта в очередь \textbf{DPS}.